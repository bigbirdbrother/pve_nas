硬盘仓风扇控制脚本 - README

概述:
这是一个通过硬盘温度控制硬盘仓风扇速度的脚本。它会根据硬盘的温度变化来调整风扇转速，保证硬盘温度不超过安全范围。脚本支持动态获取硬盘温度，排除固态硬盘（SSD），并根据最高温度来控制风扇。

依赖：
1. `smartctl` - 用于读取硬盘的SMART信息。
2. `fancontrol` - 用于控制风扇的速度。
3. `pwmconfig` - 用于确定每个风扇的控制针脚。

功能：
- 动态读取系统中所有硬盘的温度。
- 排除SSD硬盘，避免对固态硬盘进行风扇控制。
- 控制硬盘仓风扇的PWM值，根据硬盘温度决定风扇转速。
- 每次脚本执行时，记录日志并输出相应的信息。

步骤：
1. 通过 `pwmconfig` 确定风扇针脚对应关系：
    - 执行 `pwmconfig` 命令，根据提示测试每个风扇并查看其响应(坑比较多,建议求助chatgpt, 设置完成后风扇转速可能会一直保持最高,reboot可解决)。
    - 将风扇的PWM值设置为最大（255）和停止（0），以帮助识别每个风扇。
    - 根据 `pwmconfig` 输出的结果，记录你系统中的PWM控制针脚。
    - 例如：`pwm1` 可能控制主板仓风扇，`pwm2` 控制CPU风扇，`pwm5` 控制硬盘仓风扇。
    - 注意：你需要根据自己系统的具体情况修改对应的PWM针脚。

2. 修改脚本中的 `fan_pwm` 路径：
    - 根据你的 `pwmconfig` 输出，修改 `fan_pwm` 变量为控制硬盘仓风扇的 PWM 控制路径。
    - 例如：如果硬盘仓风扇由 `pwm5` 控制，修改为 `/sys/class/hwmon/hwmon2/pwm5`。

3. 设置硬盘温度阈值：
    - 修改脚本中的 `min_temp` 和 `max_temp` 变量，设置合适的硬盘温度范围。
    - 默认：温度低于28°C时风扇关闭，温度超过40°C时风扇最大转速。

4. 安装依赖：
    - 确保安装了 `smartmontools`（包含 `smartctl`）以及 `fancontrol`。使用以下命令安装：
      ```
      sudo apt-get install smartmontools fancontrol
      ```


5. 配置 `cron` 定时任务：
    - 通过执行 `crontab -e` 添加定时任务，每分钟运行一次脚本：
      ```
      * * * * * /opt/disk-fan-control/disk_fan_control.sh >> /opt/disk-fan-control/disk_fan_control.log 2>&1
      ```
    - 日志会被输出到 `/opt/disk-fan-control/disk_fan_control.log`，你可以查看每次脚本执行时的风扇控制情况。

6. 查看日志：
    - 执行日志查看命令：`cat /opt/disk-fan-control/disk_fan_control.log`。
    - 日志会显示每次脚本执行时的风扇控制情况，包括硬盘温度和PWM值。

脚本工作原理：
- 脚本会扫描所有硬盘，并读取它们的SMART信息来获取温度。
- 如果硬盘是SSD（如西数的WD Blue/Red/Green系列），则脚本会跳过这些硬盘，不进行风扇调整。
- 脚本会选择温度最高的硬盘作为参考，并计算相应的PWM值来调整风扇转速：
    - 温度低于设定的最低值（默认为28°C），风扇停止。
    - 温度高于设定的最高值（默认为40°C），风扇最大转速。
    - 温度介于最低值和最高值之间时，风扇转速线性调整。

注意事项：
1. 确保硬盘支持SMART，并且可以通过 `smartctl` 正常获取温度信息。
2. 本脚本默认排除了固态硬盘（如WD Blue/Red/Green SSDs），你可以根据需要修改排除的硬盘型号。
3. 如果你有多个硬盘仓，可能需要修改脚本中的硬盘仓风扇控制针脚（例如 `pwm5`）。
4. `pwmconfig` 工具帮助确定风扇的PWM针脚对应关系，确保正确配置脚本中的 `fan_pwm` 路径。
5. 你可以根据自己的需求调整温度范围和风扇转速的映射关系。

